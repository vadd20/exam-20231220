# 20231213

Задача экзамена по Java 13/12/2023

На входе есть csv-файл, который получен от смежной команды. До реализации полноценной интеграции нам необходимо загрузить данные в систему вставкой в БД.

Пример данных в csv-файле:

```
CSV (id, name, level, code, parent):
2,Региональное отделение Единой России в Пермском крае,1,05,1
1,Всероссийская политическая партия "Единая Россия",0,01,
3,Региональное отделение Единой России в Якутии,1,06,1
```
 
Схема целевой БД:

```
CREATE TABLE political_party (
           id uuid NOT NULL
                CONSTRAINT political_party_pkey
            PRIMARY KEY,
           external_id integer NOT NULL,
           name varchar(255) NOT NULL,
           action_level varchar(255) NOT NULL,
           parent_id uuid,
           party_code
);
 
ALTER TABLE political_party ADD CONSTRAINT fk_political_party_parent FOREIGN KEY
    (parent_id) REFERENCES political_party (id);
```
              
*Задание:* необходимо разобрать csv-файл и сгенерировать sql-файл, содержащий инструкции для корректной вставки записей в таблицу political_party. Особые требования по заполнению колонок таблицы:
id - сгенерировать uuid
external_id - заполнить из csv как есть (из поля id в csv)
name - заполнить из csv как есть (из поля name в csv)
action_level - перекодировать число в строку: 0 - FEDERAL, 1 – REGIONAL (на основе поля level в csv)
parent_id - указатель на родительскую запись (на основе поля parent в csv)
party_code - полный код партии, формируется по алгоритму: FFRR, где FF - код партии федерального уровня, RR - код партии регионального уровня (для партий фед.уровня заполняется нулями) (на основе поля code в csv)
 
Шаблон для одной строки выходного файла:

```
INSERT INTO political_party(id, external_id, name, action_level, parent_id, party_code) VALUES ( , , , , , , , );
```
 
*Критерий успеха:* сформированный файл успешно накатится на БД (таблица перед тестом будет пустой).

*Дополнительные требования:*
Перед загрузкой необходимо провести валидацию csv по правилам ниже и если найдена хотя бы одна ошибка, то вместо формирования sql-файла вывести в консоль информацию обо всех проблемных записях в формате: '<id записи или номер строки в csv>: <ошибка 1>, <ошибка 2> …'
* Если встретятся записи, которые ссылаются на родителя, которого нет в csv, то считать это ошибкой
* Если название партии не уместится в 255 символов, то считать это ошибкой
* Допустимый уровень партии 0 и 1. Если встретится иное значение, считать это ошибкой

Если валидация csv пройдена успешно, то вывести в консоль статистику:
'Обработано <число партий фед уровня> партий федерального уровня и <число партий рег уровня> партий регионального уровня'.
